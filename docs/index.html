<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transformers: Battle for Control</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #581c87 50%, #0f172a 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Faction Selection */
        .faction-selection {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        .faction-title {
            text-align: center;
            margin-bottom: 60px;
        }

        .faction-title h1 {
            font-size: 4rem;
            font-weight: bold;
            background: linear-gradient(to right, #22d3ee, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
        }

        .faction-title h2 {
            font-size: 2rem;
            color: #d1d5db;
            margin-bottom: 20px;
        }

        .faction-title p {
            color: #9ca3af;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .faction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            max-width: 1200px;
            width: 100%;
        }

        .faction-card {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border: 2px solid #475569;
            border-radius: 12px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .faction-card:hover {
            border-color: #22d3ee;
            transform: scale(1.05);
            box-shadow: 0 20px 60px rgba(34, 211, 238, 0.5);
        }

        .faction-icon {
            font-size: 4rem;
            text-align: center;
            margin-bottom: 20px;
            opacity: 0.6;
            transition: opacity 0.3s;
        }

        .faction-card:hover .faction-icon {
            opacity: 1;
        }

        .faction-card h3 {
            font-size: 1.75rem;
            text-align: center;
            margin-bottom: 10px;
            transition: color 0.3s;
        }

        .faction-card:hover h3 {
            color: #22d3ee;
        }

        .faction-card p {
            color: #9ca3af;
            text-align: center;
            font-size: 0.875rem;
        }

        .faction-select-text {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #475569;
            color: #22d3ee;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .faction-card:hover .faction-select-text {
            opacity: 1;
        }

        /* Game Board */
        .game-layout {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        @media (max-width: 1024px) {
            .game-layout {
                grid-template-columns: 1fr;
            }
        }

        /* Character Panel */
        .character-panel {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid;
        }

        .character-panel.player {
            border-color: #3b82f6;
        }

        .character-panel.ai {
            border-color: #ef4444;
        }

        .character-panel h3 {
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        .character-card {
            padding: 16px;
            border-radius: 8px;
            border: 2px solid;
            margin-bottom: 12px;
            transition: all 0.3s;
        }

        .character-card.player.alive {
            background: rgba(59, 130, 246, 0.2);
            border-color: #2563eb;
        }

        .character-card.ai.alive {
            background: rgba(239, 68, 68, 0.2);
            border-color: #dc2626;
        }

        .character-card.dead {
            background: rgba(31, 41, 55, 0.2);
            border-color: #374151;
            opacity: 0.5;
        }

        .character-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            font-size: 1rem;
        }

        .stat-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .stat-icon {
            width: 16px;
            height: 16px;
        }

        .stat-progress {
            flex: 1;
            background: #1e293b;
            border-radius: 9999px;
            height: 16px;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            transition: width 0.3s;
        }

        .stat-fill.health {
            background: linear-gradient(to right, #ef4444, #dc2626);
        }

        .stat-fill.shield {
            background: linear-gradient(to right, #06b6d4, #2563eb);
        }

        .stat-value {
            font-size: 0.875rem;
            min-width: 40px;
            text-align: right;
        }

        .character-position {
            margin-top: 8px;
            font-size: 0.75rem;
            color: #9ca3af;
        }

        /* Board */
        .board-container {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
        }

        .board-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 8px;
        }

        .board-cell {
            aspect-ratio: 1;
            border: 2px solid;
            border-radius: 6px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            cursor: pointer;
        }

        .board-cell:hover {
            transform: scale(1.1);
        }

        .board-cell.normal {
            background: rgba(51, 65, 85, 0.5);
            border-color: #475569;
        }

        .board-cell.control-point {
            background: #ca8a04;
            border-color: #facc15;
        }

        .board-cell.control-point.player {
            background: #2563eb;
            border-color: #3b82f6;
        }

        .board-cell.control-point.ai {
            background: #dc2626;
            border-color: #ef4444;
        }

        .board-cell.special {
            background: rgba(147, 51, 234, 0.5);
            border-color: #a855f7;
        }

        .board-cell.benefit {
            background: rgba(22, 163, 74, 0.5);
            border-color: #4ade80;
        }

        .cell-number {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.65rem;
            color: rgba(255, 255, 255, 0.4);
        }

        .cell-label {
            position: absolute;
            bottom: 2px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .cell-character {
            position: absolute;
            inset: 4px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .cell-character.player {
            background: #3b82f6;
        }

        .cell-character.ai {
            background: #ef4444;
        }

        .board-legend {
            margin-top: 16px;
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            justify-content: center;
            font-size: 0.875rem;
            color: #d1d5db;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-box {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            border: 2px solid;
        }

        /* Action Panel */
        .action-panel {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 24px;
            border: 2px solid #22d3ee;
            max-width: 800px;
            margin: 0 auto;
        }

        .turn-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .turn-info h3 {
            font-size: 1.5rem;
        }

        .turn-player {
            color: #3b82f6;
        }

        .turn-ai {
            color: #ef4444;
        }

        .message-box {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 8px;
            padding: 16px;
            font-size: 0.875rem;
            color: #d1d5db;
            margin-bottom: 16px;
        }

        .dice-results {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
        }

        .dice-result {
            flex: 1;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .dice-result.movement {
            background: linear-gradient(135deg, #2563eb, #7c3aed);
        }

        .dice-result.ability {
            background: linear-gradient(135deg, #059669, #10b981);
        }

        .dice-result.ability.fail {
            background: linear-gradient(135deg, #4b5563, #6b7280);
        }

        .dice-label {
            font-size: 0.875rem;
            color: #e5e7eb;
            margin-bottom: 4px;
        }

        .dice-value {
            font-size: 2.5rem;
            font-weight: bold;
        }

        .actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .btn {
            padding: 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
            color: white;
        }

        .btn:hover:not(:disabled) {
            transform: scale(1.05);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(to right, #2563eb, #06b6d4);
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(to right, #1d4ed8, #0891b2);
        }

        .btn-capture {
            background: linear-gradient(to right, #ca8a04, #ea580c);
        }

        .btn-capture:hover:not(:disabled) {
            background: linear-gradient(to right, #a16207, #c2410c);
        }

        .btn-card {
            background: linear-gradient(to right, #9333ea, #ec4899);
            justify-content: space-between;
        }

        .btn-card:hover:not(:disabled) {
            background: linear-gradient(to right, #7e22ce, #db2777);
        }

        .btn-secondary {
            background: linear-gradient(to right, #4b5563, #475569);
        }

        .btn-secondary:hover:not(:disabled) {
            background: linear-gradient(to right, #374151, #334155);
        }

        .benefit-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .btn-benefit {
            background: linear-gradient(to right, #dc2626, #ec4899);
        }

        .btn-benefit:hover:not(:disabled) {
            background: linear-gradient(to right, #b91c1c, #db2777);
        }

        .btn-shield {
            background: linear-gradient(to right, #06b6d4, #2563eb);
        }

        .btn-shield:hover:not(:disabled) {
            background: linear-gradient(to right, #0891b2, #1d4ed8);
        }

        .cards-section {
            margin-bottom: 12px;
        }

        .cards-label {
            font-size: 0.875rem;
            color: #9ca3af;
            margin-bottom: 8px;
        }

        .card-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Event */
        .event-banner {
            max-width: 800px;
            margin: 24px auto 0;
            background: rgba(234, 88, 12, 0.5);
            border: 2px solid #ea580c;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .event-title {
            font-size: 1.25rem;
            margin-bottom: 8px;
        }

        .event-description {
            font-size: 0.875rem;
            color: #d1d5db;
        }

        /* Game Over */
        .game-over-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .game-over-modal {
            background: #0f172a;
            border: 2px solid #22d3ee;
            border-radius: 16px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            box-shadow: 0 25px 50px rgba(34, 211, 238, 0.5);
        }

        .game-over-emoji {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .game-over-title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .game-over-title.victory {
            background: linear-gradient(to right, #3b82f6, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-over-title.defeat {
            background: linear-gradient(to right, #ef4444, #ea580c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-over-title.draw {
            background: linear-gradient(to right, #6b7280, #475569);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-over-subtitle {
            color: #9ca3af;
            margin-bottom: 32px;
        }

        .hidden {
            display: none !important;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: #1e293b;
            border: 2px solid;
            border-radius: 8px;
            padding: 16px;
            min-width: 300px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            border-color: #10b981;
        }

        .toast.error {
            border-color: #ef4444;
        }

        .toast.warning {
            border-color: #f59e0b;
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Faction Selection Screen -->
    <div id="factionSelection" class="faction-selection">
        <div class="faction-title">
            <h1>TRANSFORMERS</h1>
            <h2>Battle for Control</h2>
            <p>Elige tu facci√≥n y lucha por el control de los tres puntos estrat√©gicos. ¬°El destino de Cybertron est√° en tus manos!</p>
        </div>
        
        <div class="faction-grid">
            <div class="faction-card" onclick="selectFaction('autobots')">
                <div class="faction-icon">üõ°Ô∏è</div>
                <h3>Autobots</h3>
                <p>Defensores de la libertad y la justicia</p>
                <div class="faction-select-text">Seleccionar ‚Üí</div>
            </div>
            
            <div class="faction-card" onclick="selectFaction('decepticons')">
                <div class="faction-icon">üíÄ</div>
                <h3>Decepticons</h3>
                <p>Conquistadores despiadados</p>
                <div class="faction-select-text">Seleccionar ‚Üí</div>
            </div>
            
            <div class="faction-card" onclick="selectFaction('primals')">
                <div class="faction-icon">üî•</div>
                <h3>Primals</h3>
                <p>Guerreros org√°nicos ancestrales</p>
                <div class="faction-select-text">Seleccionar ‚Üí</div>
            </div>
            
            <div class="faction-card" onclick="selectFaction('mercenarios')">
                <div class="faction-icon">‚ö°</div>
                <h3>Mercenarios</h3>
                <p>Luchadores por el mejor postor</p>
                <div class="faction-select-text">Seleccionar ‚Üí</div>
            </div>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="container hidden">
        <div class="game-layout">
            <!-- Player Panel -->
            <div id="playerPanel" class="character-panel player">
                <h3 id="playerTitle">Jugador</h3>
                <div id="playerCharacters"></div>
            </div>
            
            <!-- Board -->
            <div class="board-container">
                <div class="board-grid" id="boardGrid"></div>
                <div class="board-legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #ca8a04; border-color: #facc15;"></div>
                        <span>Punto de Control</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: rgba(147, 51, 234, 0.5); border-color: #a855f7;"></div>
                        <span>Casilla Especial (Arma)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: rgba(22, 163, 74, 0.5); border-color: #4ade80;"></div>
                        <span>Beneficio</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #3b82f6;"></div>
                        <span>Jugador</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #ef4444;"></div>
                        <span>IA</span>
                    </div>
                </div>
            </div>
            
            <!-- AI Panel -->
            <div id="aiPanel" class="character-panel ai">
                <h3 id="aiTitle">IA</h3>
                <div id="aiCharacters"></div>
            </div>
        </div>
        
        <!-- Action Panel -->
        <div class="action-panel">
            <div class="turn-info">
                <h3>Turno: <span id="turnIndicator">Jugador</span></h3>
                <div>Ronda: <span id="turnCount">1</span></div>
            </div>
            
            <div class="message-box" id="messageBox">
                Bienvenido a la batalla
            </div>
            
            <div id="diceResults" class="dice-results hidden"></div>
            
            <div class="actions" id="actionsContainer"></div>
        </div>
        
        <!-- Event Banner -->
        <div id="eventBanner" class="event-banner hidden">
            <div class="event-title" id="eventTitle"></div>
            <div class="event-description" id="eventDescription"></div>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="gameOverScreen" class="game-over-overlay hidden">
        <div class="game-over-modal">
            <div class="game-over-emoji" id="gameOverEmoji">üèÜ</div>
            <div class="game-over-title" id="gameOverTitle">¬°VICTORIA!</div>
            <p class="game-over-subtitle" id="gameOverSubtitle">Has dominado el campo de batalla</p>
            <button class="btn btn-primary" onclick="restartGame()">
                ‚Üª Jugar de Nuevo
            </button>
        </div>
    </div>

    <script>
        // Game State
        const FACTION_NAMES = {
            autobots: 'Autobots',
            decepticons: 'Decepticons',
            primals: 'Primals',
            mercenarios: 'Mercenarios'
        };

        const WEAPON_CARDS = [
            { id: 'blaster', name: 'Blaster', damage: 2, shieldPiercing: false },
            { id: 'missile', name: 'Misil', damage: 3, shieldPiercing: true },
            { id: 'energon-axe', name: 'Hacha Energon', damage: 2, shieldPiercing: false },
            { id: 'plasma-cannon', name: 'Ca√±√≥n de Plasma', damage: 4, shieldPiercing: true },
        ];

        const EVENTS = [
            { type: 'global-damage', name: 'Tormenta Solar', description: 'Todos los personajes pierden 1 punto de escudo' },
            { type: 'shield-blocked', name: 'Campo de Interferencia', description: 'Los escudos no funcionan este turno' },
            { type: 'meteorite', name: 'Lluvia de Meteoritos', description: 'Todos los personajes pierden 1 punto de vida' },
            { type: 'energy-boost', name: 'Energon Puro', description: 'Todos los personajes recuperan 1 punto de vida' },
        ];

        let gameState = {
            phase: 'faction-selection',
            turn: 'player',
            turnCount: 1,
            playerFaction: null,
            aiFaction: null,
            playerCharacters: [],
            aiCharacters: [],
            board: [],
            playerCards: [],
            aiCards: [],
            diceResult: null,
            abilityDiceResult: null,
            selectedCharacter: null,
            actionPhase: 'select-character',
            winner: null,
            eventActivated: false,
            currentEvent: null,
            message: 'Selecciona tu facci√≥n para comenzar'
        };

        // Utility Functions
        function createCharacter(faction, type, startPosition) {
            const isLeader = type === 'leader';
            const factionName = FACTION_NAMES[faction];
            
            return {
                id: `${faction}-${type}`,
                name: isLeader ? `L√≠der ${factionName}` : `Soldado ${factionName}`,
                type,
                faction,
                shield: isLeader ? 5 : 4,
                maxShield: isLeader ? 5 : 4,
                health: isLeader ? 4 : 3,
                maxHealth: isLeader ? 4 : 3,
                position: startPosition,
                isAlive: true,
            };
        }

        function createBoard() {
            const cells = [];
            for (let i = 0; i < 30; i++) {
                let cell = { id: i, type: 'normal' };
                
                if (i === 10) {
                    cell = { id: i, type: 'controlPoint', controlPoint: 'A', owner: null };
                } else if (i === 15) {
                    cell = { id: i, type: 'controlPoint', controlPoint: 'B', owner: null };
                } else if (i === 20) {
                    cell = { id: i, type: 'controlPoint', controlPoint: 'C', owner: null };
                } else if ([5, 12, 18, 25].includes(i)) {
                    cell = { id: i, type: 'special' };
                } else if ([3, 8, 13, 17, 22, 27].includes(i)) {
                    cell = { id: i, type: 'benefit' };
                }
                
                cells.push(cell);
            }
            return cells;
        }

        function rollDice() {
            return Math.floor(Math.random() * 6) + 1;
        }

        function rollAbilityDice() {
            const outcomes = ['Transformer', 'Transformer', 'Fallo', 'Fallo', 'Fallo', 'Fallo'];
            return outcomes[Math.floor(Math.random() * outcomes.length)];
        }

        function getRandomWeaponCard() {
            const randomIndex = Math.floor(Math.random() * WEAPON_CARDS.length);
            return { ...WEAPON_CARDS[randomIndex], id: `${WEAPON_CARDS[randomIndex].id}-${Date.now()}` };
        }

        function getRandomEvent() {
            const randomIndex = Math.floor(Math.random() * EVENTS.length);
            return EVENTS[randomIndex];
        }

        function applyDamage(character, damage, shieldPiercing) {
            let newShield = character.shield;
            let newHealth = character.health;
            
            if (shieldPiercing) {
                newHealth -= damage;
            } else {
                if (newShield > 0) {
                    const shieldDamage = Math.min(damage, newShield);
                    newShield -= shieldDamage;
                    const remainingDamage = damage - shieldDamage;
                    if (remainingDamage > 0) {
                        newHealth -= remainingDamage;
                    }
                } else {
                    newHealth -= damage;
                }
            }
            
            newHealth = Math.max(0, newHealth);
            newShield = Math.max(0, newShield);
            
            return {
                ...character,
                shield: newShield,
                health: newHealth,
                isAlive: newHealth > 0,
            };
        }

        function healCharacter(character) {
            return {
                ...character,
                health: Math.min(character.health + 1, character.maxHealth),
            };
        }

        function addShield(character) {
            return {
                ...character,
                shield: Math.min(character.shield + 1, character.maxShield),
            };
        }

        function isAdjacentPosition(pos1, pos2) {
            return Math.abs(pos1 - pos2) === 1 || (pos1 === 0 && pos2 === 29) || (pos1 === 29 && pos2 === 0);
        }

        function checkWinCondition() {
            const playerAlive = gameState.playerCharacters.some(c => c.isAlive);
            const aiAlive = gameState.aiCharacters.some(c => c.isAlive);
            
            if (!playerAlive && !aiAlive) return 'draw';
            if (!playerAlive) return 'ai';
            if (!aiAlive) return 'player';
            
            const controlPoints = gameState.board.filter(cell => cell.type === 'controlPoint');
            const playerControlled = controlPoints.filter(cell => cell.owner === 'player').length;
            const aiControlled = controlPoints.filter(cell => cell.owner === 'ai').length;
            
            if (playerControlled === 3) return 'player';
            if (aiControlled === 3) return 'ai';
            
            return null;
        }

        // Toast Notifications
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Faction Selection
        function selectFaction(faction) {
            const availableFactions = ['autobots', 'decepticons', 'primals', 'mercenarios'];
            const aiFaction = availableFactions.filter(f => f !== faction)[Math.floor(Math.random() * 3)];
            
            gameState.playerFaction = faction;
            gameState.aiFaction = aiFaction;
            gameState.playerCharacters = [
                createCharacter(faction, 'leader', 0),
                createCharacter(faction, 'soldier', 1),
            ];
            gameState.aiCharacters = [
                createCharacter(aiFaction, 'leader', 15),
                createCharacter(aiFaction, 'soldier', 16),
            ];
            gameState.board = createBoard();
            gameState.phase = 'game';
            gameState.message = `¬°La batalla comienza! ${FACTION_NAMES[faction]} vs ${FACTION_NAMES[aiFaction]}`;
            
            document.getElementById('factionSelection').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            showToast(`Has seleccionado ${FACTION_NAMES[faction]}`);
            
            render();
        }

        // Render Functions
        function renderCharacterPanel(characters, elementId, isPlayer) {
            const container = document.getElementById(elementId);
            container.innerHTML = characters.map(char => `
                <div class="character-card ${isPlayer ? 'player' : 'ai'} ${char.isAlive ? 'alive' : 'dead'}">
                    <div class="character-header">
                        <span>${char.type === 'leader' ? 'üëë' : '‚öîÔ∏è'}</span>
                        <span>${char.name}</span>
                        ${!char.isAlive ? '<span>üíÄ</span>' : ''}
                    </div>
                    <div class="stat-bar">
                        <span class="stat-icon">‚ù§Ô∏è</span>
                        <div class="stat-progress">
                            <div class="stat-fill health" style="width: ${(char.health / char.maxHealth) * 100}%"></div>
                        </div>
                        <span class="stat-value">${char.health}/${char.maxHealth}</span>
                    </div>
                    <div class="stat-bar">
                        <span class="stat-icon">üõ°Ô∏è</span>
                        <div class="stat-progress">
                            <div class="stat-fill shield" style="width: ${(char.shield / char.maxShield) * 100}%"></div>
                        </div>
                        <span class="stat-value">${char.shield}/${char.maxShield}</span>
                    </div>
                    <div class="character-position">Posici√≥n: ${char.position}</div>
                </div>
            `).join('');
        }

        function renderBoard() {
            const container = document.getElementById('boardGrid');
            
            container.innerHTML = gameState.board.map(cell => {
                let cellClass = `board-cell ${cell.type}`;
                if (cell.type === 'controlPoint' && cell.owner) {
                    cellClass += ` ${cell.owner}`;
                }
                
                const playerChar = gameState.playerCharacters.find(c => c.position === cell.id && c.isAlive);
                const aiChar = gameState.aiCharacters.find(c => c.position === cell.id && c.isAlive);
                
                let characterHTML = '';
                if (playerChar) {
                    characterHTML = `<div class="cell-character player">${playerChar.type === 'leader' ? 'üëë' : '‚öîÔ∏è'}</div>`;
                } else if (aiChar) {
                    characterHTML = `<div class="cell-character ai">${aiChar.type === 'leader' ? 'üëë' : '‚öîÔ∏è'}</div>`;
                }
                
                let labelHTML = '';
                if (cell.type === 'controlPoint') {
                    labelHTML = `<div class="cell-label">${cell.controlPoint}</div>`;
                }
                
                return `
                    <div class="${cellClass}">
                        <div class="cell-number">${cell.id}</div>
                        ${labelHTML}
                        ${characterHTML}
                    </div>
                `;
            }).join('');
        }

        function renderActions() {
            const container = document.getElementById('actionsContainer');
            
            if (gameState.turn === 'ai') {
                container.innerHTML = '<div style="text-align: center; color: #9ca3af;">La IA est√° pensando...</div>';
                return;
            }
            
            const canRollDice = gameState.diceResult === null;
            const selectedChar = gameState.playerCharacters.find(c => c.id === gameState.selectedCharacter);
            const currentCell = selectedChar ? gameState.board[selectedChar.position] : null;
            const canCapture = gameState.actionPhase === 'action' && 
                              currentCell?.type === 'controlPoint' && 
                              currentCell.owner !== 'player';
            const canBenefit = gameState.actionPhase === 'action' && currentCell?.type === 'benefit';
            const canUseCard = gameState.actionPhase === 'action' && gameState.playerCards.length > 0;
            
            let html = '';
            
            if (canRollDice) {
                html += `<button class="btn btn-primary" onclick="handleRollDice()">üé≤ Lanzar Dado de Movimiento</button>`;
            }
            
            if (canCapture) {
                html += `<button class="btn btn-capture" onclick="handleRollAbilityDice()">üéØ Intentar Capturar Punto</button>`;
            }
            
            if (canBenefit) {
                html += `
                    <div class="benefit-grid">
                        <button class="btn btn-benefit" onclick="handleBenefit('health')">‚ù§Ô∏è +1 Vida</button>
                        <button class="btn btn-shield" onclick="handleBenefit('shield')">üõ°Ô∏è +1 Escudo</button>
                    </div>
                `;
            }
            
            if (canUseCard) {
                html += '<div class="cards-section"><div class="cards-label">Cartas de Armamento:</div>';
                gameState.playerCards.forEach((card, index) => {
                    html += `
                        <button class="btn btn-card" onclick="handleUseCard(${index})">
                            <div class="card-info">
                                <span>‚öîÔ∏è</span>
                                <span>${card.name}</span>
                            </div>
                            <div class="card-info">
                                <span>Da√±o: ${card.damage}</span>
                                ${card.shieldPiercing ? '<span>‚ú®</span>' : ''}
                            </div>
                        </button>
                    `;
                });
                html += '</div>';
            }
            
            html += `<button class="btn btn-secondary" onclick="handleEndTurn()">Terminar Turno</button>`;
            
            container.innerHTML = html;
        }

        function renderDiceResults() {
            const container = document.getElementById('diceResults');
            
            if (gameState.diceResult === null && gameState.abilityDiceResult === null) {
                container.classList.add('hidden');
                return;
            }
            
            container.classList.remove('hidden');
            let html = '';
            
            if (gameState.diceResult !== null) {
                html += `
                    <div class="dice-result movement">
                        <div class="dice-label">Dado de Movimiento</div>
                        <div class="dice-value">${gameState.diceResult}</div>
                    </div>
                `;
            }
            
            if (gameState.abilityDiceResult !== null) {
                const isSuccess = gameState.abilityDiceResult === 'Transformer';
                html += `
                    <div class="dice-result ability ${isSuccess ? '' : 'fail'}">
                        <div class="dice-label">Dado de Habilidad</div>
                        <div class="dice-value">${gameState.abilityDiceResult}</div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function render() {
            if (gameState.phase !== 'game') return;
            
            document.getElementById('playerTitle').textContent = FACTION_NAMES[gameState.playerFaction];
            document.getElementById('aiTitle').textContent = FACTION_NAMES[gameState.aiFaction];
            document.getElementById('turnIndicator').textContent = gameState.turn === 'player' ? 'Jugador' : 'IA';
            document.getElementById('turnIndicator').className = gameState.turn === 'player' ? 'turn-player' : 'turn-ai';
            document.getElementById('turnCount').textContent = gameState.turnCount;
            document.getElementById('messageBox').textContent = gameState.message;
            
            renderCharacterPanel(gameState.playerCharacters, 'playerCharacters', true);
            renderCharacterPanel(gameState.aiCharacters, 'aiCharacters', false);
            renderBoard();
            renderActions();
            renderDiceResults();
            
            if (gameState.currentEvent) {
                document.getElementById('eventBanner').classList.remove('hidden');
                document.getElementById('eventTitle').textContent = `‚ö° Evento: ${gameState.currentEvent.name}`;
                document.getElementById('eventDescription').textContent = gameState.currentEvent.description;
            }
        }

        // Player Actions
        function handleRollDice() {
            const dice = rollDice();
            const aliveChars = gameState.playerCharacters.filter(c => c.isAlive);
            
            if (aliveChars.length === 0) return;
            
            const selectedChar = gameState.selectedCharacter 
                ? gameState.playerCharacters.find(c => c.id === gameState.selectedCharacter)
                : aliveChars[0];
            
            if (!selectedChar) return;
            
            const newPosition = (selectedChar.position + dice) % 30;
            gameState.playerCharacters = gameState.playerCharacters.map(c =>
                c.id === selectedChar.id ? { ...c, position: newPosition } : c
            );
            
            const cell = gameState.board[newPosition];
            let message = `Moviste a ${selectedChar.name} a la casilla ${newPosition}`;
            
            if (cell.type === 'special' && gameState.playerCards.length < 2) {
                const newCard = getRandomWeaponCard();
                gameState.playerCards.push(newCard);
                message += ` y obtuviste ${newCard.name}!`;
                showToast(`¬°Carta obtenida: ${newCard.name}!`);
            }
            
            gameState.diceResult = dice;
            gameState.selectedCharacter = selectedChar.id;
            gameState.actionPhase = 'action';
            gameState.message = message;
            
            render();
        }

        function handleRollAbilityDice() {
            const result = rollAbilityDice();
            const selectedChar = gameState.playerCharacters.find(c => c.id === gameState.selectedCharacter);
            
            if (!selectedChar) return;
            
            const cell = gameState.board[selectedChar.position];
            
            if (cell.type === 'controlPoint' && result === 'Transformer') {
                gameState.board = gameState.board.map(c =>
                    c.id === cell.id ? { ...c, owner: 'player' } : c
                );
                gameState.message = `¬°Capturaste el punto ${cell.controlPoint}!`;
                showToast(`¬°Punto ${cell.controlPoint} capturado!`);
            } else {
                gameState.message = result === 'Transformer' ? '√âxito, pero no hay punto que capturar' : 'Fallo al intentar capturar';
            }
            
            gameState.abilityDiceResult = result;
            render();
        }

        function handleUseCard(cardIndex) {
            const card = gameState.playerCards[cardIndex];
            const selectedChar = gameState.playerCharacters.find(c => c.id === gameState.selectedCharacter);
            
            if (!card || !selectedChar) return;
            
            const targetAI = gameState.aiCharacters.find(ai =>
                ai.isAlive && isAdjacentPosition(selectedChar.position, ai.position)
            );
            
            if (targetAI) {
                const damagedAI = applyDamage(targetAI, card.damage, card.shieldPiercing);
                gameState.aiCharacters = gameState.aiCharacters.map(c =>
                    c.id === targetAI.id ? damagedAI : c
                );
                gameState.playerCards = gameState.playerCards.filter((_, i) => i !== cardIndex);
                gameState.message = `¬°Atacaste a ${targetAI.name} con ${card.name}! Da√±o: ${card.damage}`;
                showToast(`¬°Ataque exitoso!${!damagedAI.isAlive ? ' Enemigo eliminado!' : ''}`);
            } else {
                showToast('No hay enemigos adyacentes para atacar', 'error');
            }
            
            render();
        }

        function handleBenefit(type) {
            const selectedChar = gameState.playerCharacters.find(c => c.id === gameState.selectedCharacter);
            
            if (!selectedChar) return;
            
            const cell = gameState.board[selectedChar.position];
            
            if (cell.type === 'benefit') {
                const updatedChar = type === 'health' ? healCharacter(selectedChar) : addShield(selectedChar);
                gameState.playerCharacters = gameState.playerCharacters.map(c =>
                    c.id === selectedChar.id ? updatedChar : c
                );
                gameState.message = `¬°${selectedChar.name} recibi√≥ +1 ${type === 'health' ? 'Vida' : 'Escudo'}!`;
                showToast(`+1 ${type === 'health' ? 'Vida' : 'Escudo'}`);
            }
            
            render();
        }

        function handleEndTurn() {
            const winner = checkWinCondition();
            
            if (winner) {
                showGameOver(winner);
                return;
            }
            
            if (gameState.turnCount >= 8 && !gameState.eventActivated) {
                const currentEvent = getRandomEvent();
                gameState.eventActivated = true;
                gameState.currentEvent = currentEvent;
                showToast(`¬°Evento activado: ${currentEvent.name}!`, 'warning');
                
                if (currentEvent.type === 'global-damage') {
                    gameState.playerCharacters = gameState.playerCharacters.map(c => ({
                        ...c,
                        shield: Math.max(0, c.shield - 1),
                    }));
                    gameState.aiCharacters = gameState.aiCharacters.map(c => ({
                        ...c,
                        shield: Math.max(0, c.shield - 1),
                    }));
                } else if (currentEvent.type === 'meteorite') {
                    gameState.playerCharacters = gameState.playerCharacters.map(c => ({
                        ...c,
                        health: Math.max(0, c.health - 1),
                        isAlive: c.health - 1 > 0,
                    }));
                    gameState.aiCharacters = gameState.aiCharacters.map(c => ({
                        ...c,
                        health: Math.max(0, c.health - 1),
                        isAlive: c.health - 1 > 0,
                    }));
                } else if (currentEvent.type === 'energy-boost') {
                    gameState.playerCharacters = gameState.playerCharacters.map(c => healCharacter(c));
                    gameState.aiCharacters = gameState.aiCharacters.map(c => healCharacter(c));
                }
            }
            
            gameState.turn = 'ai';
            gameState.actionPhase = 'select-character';
            gameState.diceResult = null;
            gameState.abilityDiceResult = null;
            gameState.selectedCharacter = null;
            gameState.message = 'Turno de la IA...';
            
            render();
            
            setTimeout(executeAITurn, 1500);
        }

        // AI Turn
        function executeAITurn() {
            const aliveAIChars = gameState.aiCharacters.filter(c => c.isAlive);
            
            if (aliveAIChars.length === 0) {
                finishAITurn();
                return;
            }
            
            const selectedChar = aliveAIChars.sort((a, b) => a.health - b.health)[0];
            const dice = rollDice();
            const newPosition = (selectedChar.position + dice) % 30;
            
            gameState.aiCharacters = gameState.aiCharacters.map(c =>
                c.id === selectedChar.id ? { ...c, position: newPosition } : c
            );
            
            let message = `IA movi√≥ ${selectedChar.name} a la casilla ${newPosition}`;
            
            const cell = gameState.board[newPosition];
            
            if (cell.type === 'special' && gameState.aiCards.length < 2) {
                const newCard = getRandomWeaponCard();
                gameState.aiCards.push(newCard);
                message += ' y obtuvo un arma';
            }
            
            if (cell.type === 'benefit') {
                const benefitType = selectedChar.health < selectedChar.maxHealth ? 'health' : 'shield';
                const updatedChar = benefitType === 'health' ? healCharacter(selectedChar) : addShield(selectedChar);
                gameState.aiCharacters = gameState.aiCharacters.map(c =>
                    c.id === selectedChar.id ? updatedChar : c
                );
                message += ` y recibi√≥ +1 ${benefitType === 'health' ? 'Vida' : 'Escudo'}`;
            }
            
            const adjacentPlayer = gameState.playerCharacters.find(p =>
                p.isAlive && isAdjacentPosition(newPosition, p.position)
            );
            
            if (adjacentPlayer && gameState.aiCards.length > 0) {
                const card = gameState.aiCards[0];
                const damagedPlayer = applyDamage(adjacentPlayer, card.damage, card.shieldPiercing);
                gameState.playerCharacters = gameState.playerCharacters.map(c =>
                    c.id === adjacentPlayer.id ? damagedPlayer : c
                );
                gameState.aiCards = gameState.aiCards.slice(1);
                message += ` y atac√≥ a ${adjacentPlayer.name}!`;
                showToast(`¬°La IA te atac√≥ con ${card.name}!`, 'error');
            }
            
            if (cell.type === 'controlPoint' && cell.owner !== 'ai') {
                const abilityResult = rollAbilityDice();
                if (abilityResult === 'Transformer') {
                    gameState.board = gameState.board.map(c =>
                        c.id === cell.id ? { ...c, owner: 'ai' } : c
                    );
                    message += ` y captur√≥ el punto ${cell.controlPoint}!`;
                    showToast(`¬°La IA captur√≥ el punto ${cell.controlPoint}!`, 'warning');
                }
            }
            
            gameState.message = message;
            gameState.diceResult = dice;
            render();
            
            setTimeout(finishAITurn, 2000);
        }

        function finishAITurn() {
            const winner = checkWinCondition();
            
            if (winner) {
                showGameOver(winner);
                return;
            }
            
            gameState.turn = 'player';
            gameState.turnCount++;
            gameState.actionPhase = 'select-character';
            gameState.diceResult = null;
            gameState.abilityDiceResult = null;
            gameState.message = 'Tu turno';
            
            render();
        }

        // Game Over
        function showGameOver(winner) {
            gameState.phase = 'game-over';
            gameState.winner = winner;
            
            const overlay = document.getElementById('gameOverScreen');
            const emoji = document.getElementById('gameOverEmoji');
            const title = document.getElementById('gameOverTitle');
            const subtitle = document.getElementById('gameOverSubtitle');
            
            if (winner === 'player') {
                emoji.textContent = 'üèÜ';
                title.textContent = '¬°VICTORIA!';
                title.className = 'game-over-title victory';
                subtitle.textContent = 'Has dominado el campo de batalla';
            } else if (winner === 'ai') {
                emoji.textContent = 'üíÄ';
                title.textContent = 'DERROTA';
                title.className = 'game-over-title defeat';
                subtitle.textContent = 'La IA ha conquistado Cybertron';
            } else {
                emoji.textContent = 'ü§ù';
                title.textContent = 'EMPATE';
                title.className = 'game-over-title draw';
                subtitle.textContent = 'La batalla termina en tablas';
            }
            
            overlay.classList.remove('hidden');
        }

        function restartGame() {
            gameState = {
                phase: 'faction-selection',
                turn: 'player',
                turnCount: 1,
                playerFaction: null,
                aiFaction: null,
                playerCharacters: [],
                aiCharacters: [],
                board: [],
                playerCards: [],
                aiCards: [],
                diceResult: null,
                abilityDiceResult: null,
                selectedCharacter: null,
                actionPhase: 'select-character',
                winner: null,
                eventActivated: false,
                currentEvent: null,
                message: 'Selecciona tu facci√≥n para comenzar'
            };
            
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('factionSelection').classList.remove('hidden');
            document.getElementById('eventBanner').classList.add('hidden');
        }
    </script>
</body>
</html>
